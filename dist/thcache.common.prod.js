/*!
 * THCache.js v1.0.3
 * (c) 2020-2020 Challenger
 * Released under the MIT License.
 */
/*!
 * THCache.js v1.0.3
 * (c) 2020-2020 Challenger
 * Released under the MIT License.
 */
"use strict";function t(n){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}
/*!
 * TCache.js v1.0.3
 * (c) 2020-2020 Challenger
 * Released under the MIT License.
 */Object.defineProperty(exports,"__esModule",{value:!0});var n=Object.create(null);function e(t,n){void 0===n&&(n=null),this.cacheData[t]=n}function r(t,n){void 0===n&&(n=null),this.cacheData[t]=n}function o(t){var n=this.cacheData[t];return n||null}function i(t){delete this.cacheData[t]}function u(){var t=this;Object.keys(this.cacheData).forEach((function(n){delete t.cacheData[n]}))}function a(){return Object.keys(this.cacheData)}function c(t){void 0===t&&(t="defaultCache"),this._init(t)}!function(t){t.prototype._init=function(e){this._moduleName=e,t._moduleNames.push(e),this.cacheData=function(t){return n[t]||(n[t]={}),n[t]}(e)}}(c),function(t){var n={add:e,set:r,get:o,remove:i,reset:u,getKeys:a};Object.keys(n).forEach((function(e){t.prototype[e]=n[e]}))}(c),c._index=0,c._moduleNames=[],c.version="1.0.3";var f=c,l=["get","post","delete","head","options","put","patch"],s=[];function p(t){var n=y(t.url,t.method),e=k(t),r=function(t){var n,e=j.get(t),r=x(t),o=r.url,i=r.method,u=null!==(n=y(o,i))&&void 0!==n?n:{},a=D(u,o);if(!e||a)return null;var c=e.data,f=e.createTime,l=u.keepTime,s=void 0===l?3e3:l;if("forever"!==s){if(s-=0,new Date-f>s)return function(t){j.remove(t)}(t),null}return T(c,{excludeAttrs:["request"],attrs:{isCache:!0}})}(e);return n?s.includes(e)?"loading":r||(s.push(e),"normal"):"no option"}function v(t,n){var e=y(t.url),r=k(t);return e&&e.dataFormat&&(n=e.dataFormat(n)),s.includes(r)&&(!function(t,n){var e,r=new Date-0,o=x(t).url,i=(null!==(e=y(o))&&void 0!==e?e:{}).local,u=void 0===i?"default":i,a={createTime:r,data:n};if(j.add(t,a),"storage"===u){var c=function(t){return"HTTP-CACHE:"+t}(t);localStorage&&localStorage.setItem(c,C(a))}}(r,n),s.splice(s.indexOf(r),1)),n}var d=new f("precise-options"),h=new f("fuzzy-options");function y(t){var n,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",r=(null!==(n=d.get(t))&&void 0!==n?n:{})[e];if(!r){var o=[];h.getKeys().forEach((function(n){var e=h.get(n);g(t,n)&&(e._key=n,o.push(e))})),o.sort((function(t,n){return n._key.length-t._key.length})),r=i(o,e,t),console.log("getOption",r)}function i(t,n,e){for(var r=null,o=0;o<t.length;o++){var i;if((r=null!==(i=t[o][n])&&void 0!==i?i:t[o].all)&&!D(r,e))break}return r}return r}function g(t,n){return t.startsWith(n)}function m(t){t.forEach((function(t){b(t)}))}function b(t){!function(t){var n,e=t=T(t),r=e.type,o=void 0===r?"precise":r,i=e.url,u=e.method,a=void 0===u?"all":u;if(a=a.toLowerCase(),!i&&""!==i)throw new Error("option error:missing attribute 'url'");_(i);var c="precise"===o?w:E,f=null!==(n=c.get(i))&&void 0!==n?n:{};f[a]=t,c.add(i,f)}(t)}function O(){}var j=new f("_http-cache-data"),w=new f("precise-options"),E=new f("fuzzy-options"),S=Object.prototype.toString;function _(t){w.remove(t),E.remove(t)}function k(t){var n=t.url,e=t.params,r=t.data,o=t.method;return z(e)&&(e=P(e)),z(r)&&(r=P(r)),C({url:n,params:e=A(e),data:r=A(r),method:o})}function x(t){return P(t)}function A(t){var n={},e=Object.keys(t);return e.sort(),e.forEach((function(e){n[e]=t[e]})),n}function D(t,n){var e=(null!=t?t:{}).excludes,r=!1;return(void 0===e?[]:e).forEach((function(t){(t===n||g(n,t))&&(r=!0)})),r}function T(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=n.excludeAttrs,r=void 0===e?[]:e,o=n.attrs,i=void 0===o?{}:o;if(z(t)||q(t))return t;if(N(t))return P(C(t));for(var u in t)F(t[u])&&!r.includes(u)?t[u]=T(t[u]):B(t[u])&&(t[u]=H(t[u],t));return Object.assign({},t,i)}function C(t){return JSON.stringify(t)}function P(t){return JSON.parse(t)}function H(t,n){return function(){for(var e=arguments,r=new Array(arguments.length),o=0;o<r.length;o++)r[o]=e[o];return t.apply(n,r)}}function F(t){if("[object Object]"!==S.call(t))return!1;var n=Object.getPrototypeOf(t);return null===n||n===Object.prototype}function N(t){return"[object Array]"===S.call(t)}function z(t){return"string"==typeof t}function q(t){return"number"==typeof t}function B(t){return"[object Function]"===S.call(t)}function U(n,e){if(null!=n)if("object"!==t(n)&&(n=[n]),N(n))for(var r=0,o=n.length;r<o;r++)e.call(null,n[r],r,n);else for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.call(null,n[i],i,n)}var I={clone:T,parse:P,stringify:C,bind:H,extend:function(t,n,e){for(var r in n){var o=n[r];t[r]=e&&"function"==typeof o?H(o,e):o}return t},isPlainObject:F,merge:function t(){var n=arguments,e={};function r(n,r){F(e[r])&&F(n)?e[r]=t(e[r],n):F(n)?e[r]=t({},n):N(n)?e[r]=n.slice():e[r]=n}for(var o=0,i=arguments.length;o<i;o++)U(n[o],r);return e},isArray:N,isUndefined:function(t){return void 0===t},forEach:U,isString:z,isNumber:q,isFunction:B,compose:function(){for(var t=arguments,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=t[r];var o=e[0],i=e.slice(1);return function(){var t=o.apply(void 0,arguments);return i.forEach((function(n){t=n(t)})),t}}};function J(t){t&&this._init(t)}function K(t){var n=function(){return t.apply(void 0,arguments).catch((function(t){return L(t)}))};return I.extend(n,t,t),n}function W(t){!function(t){var n;n=t.interceptors.request.use((function(t){console.log("config",t);var n=p(function(t){var n=t.url,e=t.params,r=void 0===e?{}:e,o=t.data,i=void 0===o?{}:o;return{url:n,params:r,method:t.method,data:i}}(t));if("no option"===n||"normal"===n)return t;throw{config:t,type:n}}));for(var e=t.interceptors.request.handlers,r=e.length,o=0;o<r;o++)if(e[o]&&o!==n){var i=e[o];e[o]=null,e.push(i)}}(t),function(t){var n=-1,e=t.interceptors.response.use;function r(){n=t.interceptors.response.use((function(t){return t=v(function(t){var n=t.config,e=n.url,r=n.params,o=void 0===r?{}:r,i=n.data,u=void 0===i?{}:i;return{url:e,params:o,method:n.method,data:u}}(t),t)}),"useFilter"),console.log(n)}t.interceptors.response.use=function(){for(var o=arguments,i=arguments.length,u=new Array(i),a=0;a<i;a++)u[a]=o[a];var c=e.call.apply(e,[this].concat(u));return"useFilter"!==u[u.length-1]&&(t.interceptors.response.eject(n),r()),c},r()}(t),function(t){l.forEach((function(n){var e=t[n];t[n]=function(){return e.apply(void 0,arguments).catch((function(t){return L(t)}))}}))}(t)}function L(t){t.config;var n=t.type,e=void 0===n?null:n;if(e)return new Promise("loading"===e?function(){}:function(t){t(e)});var r=t;return new Promise((function(t,n){n(r)}))}!function(t){t.prototype._init=function(t){this.setOptions(t),function(){if(!localStorage)return;Object.keys(localStorage).forEach((function(t){var n,e,r=localStorage.getItem(t);(t=function(t){var n=t.startsWith("HTTP-CACHE:");n&&(n=t.replace("HTTP-CACHE:",""));return n}(t))&&(n=t,e=I.parse(r),j.add(n,e))}))}()}}(J),function(t){var n={getOptionByUrl:y,setOptions:m,removeOptionByUrl:_,setOption:b,setDebgger:O};Object.keys(n).forEach((function(e){t.prototype[e]=function(){var t=n[e].apply(n,arguments);return"bindHttp"===e?t:I.clone(t)}}))}(J),exports.TBindAxios=function(t){return t=function(t){var n=(t=K(t)).create;return t.create=function(){var t=n.apply(void 0,arguments);return W(t=K(t)),t},W(t),t}(t)},exports.default=J;